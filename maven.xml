<project default="java:jar" xmlns:j="jelly:core">

  <goal name="jelly-task" prereqs="java:compile, test:compile">
	<path id="test.classpath">
	    <pathelement path="${maven.build.dest}"/>
	    <pathelement path="target/classes"/>
	    <pathelement path="target/test-classes"/>
	    <path refid="maven.dependency.classpath"/>
	</path>
  </goal>

  <goal name="sql:generate-sql" prereqs="jelly-task" 
	description="Generates the SQL DDL for creating and dropping the database">

<!--
	if we could set the threads context class loader to ${test.classpath} 
	then this could work...
	
	<j:include uri="src/jelly/createSql.jelly"/>
-->	

    <java classname="org.apache.commons.jelly.Jelly" fork="yes">
      <classpath refid="test.classpath"/>
	  <arg value="src/jelly/createSql.jelly"/> 
    </java>
  </goal>
  
  <goal name="sql:create-db" prereqs="sql:generate-sql" 
	description="Runs the SQL to create a new database, dropping the previous tables">

    <java classname="org.apache.commons.jelly.Jelly" fork="yes">
      <classpath refid="test.classpath"/>
	  <arg value="src/jelly/createDb.jelly"/> 
    </java>
  </goal>
  
  
</project>
